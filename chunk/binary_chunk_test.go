package chunk

import (
	"testing"
)

var helloworld = []byte{
	0x1B, 0x4C, 0x75, 0x61, 0x53, 0x00, 0x19, 0x93, 0x0D, 0x0A, 0x1A, 0x0A, 0x04, 0x08, 0x04, 0x08, // .LuaS...........
	0x08, 0x78, 0x56, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x28, 0x77, // .xV...........(w
	0x40, 0x01, 0x11, 0x40, 0x68, 0x65, 0x6C, 0x6C, 0x6F, 0x5F, 0x77, 0x6F, 0x72, 0x6C, 0x64, 0x2E, // @..@hello_world.
	0x6C, 0x75, 0x61, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x02, 0x04, 0x00, // lua.............
	0x00, 0x00, 0x06, 0x00, 0x40, 0x00, 0x41, 0x40, 0x00, 0x00, 0x24, 0x40, 0x00, 0x01, 0x26, 0x00, // ....@.A@..$@..&.
	0x80, 0x00, 0x02, 0x00, 0x00, 0x00, 0x04, 0x06, 0x70, 0x72, 0x69, 0x6E, 0x74, 0x04, 0x0E, 0x48, // ........print..H
	0x65, 0x6C, 0x6C, 0x6F, 0x2C, 0x20, 0x57, 0x6F, 0x72, 0x6C, 0x64, 0x21, 0x01, 0x00, 0x00, 0x00, // ello, World!....
	0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x01, 0x00, // ................
	0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, // ................
	0x00, 0x00, 0x05, 0x5F, 0x45, 0x4E, 0x56, // ..._ENV
}

func TestBinaryChunk(t *testing.T) {
	proto := Undump(helloworld)
	list(proto)

}

func list(f *Prototype) {
	PrintHeader(f)
	PrintCode(f)
	PrintDetail(f)
	for _, p := range f.Protos {
		list(p)
	}
}
